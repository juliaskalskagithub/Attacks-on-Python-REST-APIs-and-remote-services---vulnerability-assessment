from flask import Flask, request
from functools import wraps
from flask import send_file

# tworzenie instancji aplikacji Flask
app = Flask(__name__)    

# definiownanie stalego tokenu do autoryzacji
API_TOKEN = "abc123"     

# funkcja sluzaca jako dekorator, ktory sprawdza, czy token podany w parametrach zapytania zadania jest prawidlowy
def require_appkey(view_function):
    @wraps(view_function)
    def decorated_function(*args, **kwargs):
        if request.args.get("token") and request.args.get("token") == API_TOKEN:
            return view_function(*args, **kwargs)
        else:
            return "Token jest nieprawidlowy", 401
    return decorated_function

# funkcja zwracajaca liczbe calkowita
@app.route("/integer")
@require_appkey
def get_integer():
    return "42", 200

# funkcja zwracajaca obraz
@app.route("/image")
@require_appkey
def get_image():
    filename = 'dane\\api.png'
    return send_file(filename, mimetype='image/png'), 200

# funkcja zwracajaca video 
@app.route('/video')
@require_appkey
def get_video():
    filename = 'dane\\APIf.mp4'
    return send_file(filename, mimetype='video/mp4'), 200

# funkcja zwracajaca ramke danych
@app.route('/csv')
@require_appkey
def get_csv2():
    filename = 'data-csv.csv'
    return send_file(filename, mimetype='csv/csv'), 200

# uruchomienie serwera aplikacji
if __name__ == "__main__":
    app.run(host='0.0.0.0')
